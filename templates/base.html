<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Handover App</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iIzM0NDk1ZSIvPgo8cGF0aCBkPSJNOCAxNkgxNk0xNiA4VjI0TTI0IDE2SDE2IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4K">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/roster_custom.css">
    <link rel="stylesheet" href="/static/roster_heatmap.css">
    <link rel="stylesheet" href="/static/dashboard_enhanced.css">
    <link rel="stylesheet" href="/static/dashboard_modern.css">
    <link rel="stylesheet" href="/static/sidebar_modern.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-right: 1px solid #34495e;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        .sidebar .nav-link {
            color: #ecf0f1;
            font-weight: 500;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0.25rem 0.5rem;
        }
        .sidebar .nav-link:hover {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: #fff;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        .sidebar .nav-link.active {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: #fff;
            box-shadow: 0 5px 15px rgba(116, 185, 255, 0.3);
        }
        .sidebar .menu-section {
            font-size: 0.85em;
            font-weight: 700;
            color: #95a5a6;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            padding-left: 1.25rem;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .sidebar .nav-link i {
            font-size: 1.1em;
            min-width: 20px;
        }
        .main-content {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        .user-profile-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .user-profile-card .card-body {
            padding: 1rem;
        }
        .user-avatar {
            border: 3px solid rgba(255,255,255,0.3);
        }
        .notification-dot {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: #55efc4;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Emergency fix for sidebar icons not showing in collapsed state */
        .modern-sidebar.collapsed .nav-icon {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            font-size: 1.3rem !important;
            color: #fff !important;
            min-width: 20px !important;
            text-align: center !important;
        }

        .modern-sidebar.collapsed .modern-nav-link {
            display: flex !important;
            align-items: center !important;
            justify-content: flex-start !important;
            padding-left: 15px !important;
        }

        .modern-sidebar.collapsed .nav-text {
            display: none !important;
        }

        .modern-sidebar.collapsed .section-icon {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            font-size: 1.2rem !important;
            min-width: 20px !important;
            text-align: center !important;
        }

        .modern-sidebar.collapsed .section-title span:not(.section-icon) {
            display: none !important;
        }

        /* Force Bootstrap Icons to load and display */
        .bi::before {
            display: inline-block !important;
            font-family: bootstrap-icons !important;
            font-style: normal !important;
            font-weight: normal !important;
            line-height: 1 !important;
            vertical-align: -.125em !important;
        }

        /* Ensure the sidebar toggle works properly */
        .modern-sidebar {
            transition: width 0.3s ease !important;
        }

        .modern-sidebar:not(.collapsed) {
            width: 280px !important;
        }

        .modern-sidebar.collapsed {
            width: 80px !important;
        }
</style>
    </head>
    <body>
    {% set show_sidebar = request and not (request.endpoint == 'auth.login' or request.endpoint == 'login') %}
    {% if show_sidebar %}
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Modern Glass-Morphism Sidebar -->
    <nav class="modern-sidebar" id="modernSidebar">
        <!-- Sidebar Header -->
        <div class="sidebar-header">
            <a href="/" class="sidebar-brand">
                <div class="brand-logo">
                    üè¢
                </div>
                <span class="brand-text">Shift Handover</span>
            </a>
        </div>
        
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebarToggle">
            <i class="bi bi-chevron-left" id="toggleIcon"></i>
        </button>
        
        <!-- Sidebar Content -->
        <div class="sidebar-content">
            <!-- Operations Section -->
            <div class="nav-section">
                <div class="section-title">
                    <span class="section-icon">üè†</span>
                    <span>Operations</span>
                </div>
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/') else '' }}" href="/" data-tooltip="Dashboard">
                        <i class="nav-icon bi bi-house-door"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </div>
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/handover') else '' }}" href="/handover" data-tooltip="Handover Form">
                        <i class="nav-icon bi bi-arrow-left-right"></i>
                        <span class="nav-text">Handover Form</span>
                    </a>
                </div>
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/reports') else '' }}" href="/reports" data-tooltip="Shift Reports">
                        <i class="nav-icon bi bi-file-earmark-text"></i>
                        <span class="nav-text">Shift Reports</span>
                    </a>
                </div>
            </div>
            
            <!-- Team Management Section -->
            <div class="nav-section">
                <div class="section-title">
                    <span class="section-icon">üë•</span>
                    <span>Team Management</span>
                </div>
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/roster') else '' }}" href="/roster" data-tooltip="Shift Roster">
                        <i class="nav-icon bi bi-calendar3"></i>
                        <span class="nav-text">Shift Roster</span>
                    </a>
                </div>
                {% if current_user.role in ['super_admin', 'account_admin', 'team_admin'] %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/roster-upload') else '' }}" href="/roster-upload" data-tooltip="Roster Upload">
                        <i class="nav-icon bi bi-cloud-upload"></i>
                        <span class="nav-text">Roster Upload</span>
                    </a>
                </div>
                {% endif %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/team') else '' }}" href="/team" data-tooltip="Team Details">
                        <i class="nav-icon bi bi-people"></i>
                        <span class="nav-text">Team Details</span>
                    </a>
                </div>
            </div>
            
            <!-- Tools Section -->
            <div class="nav-section">
                <div class="section-title">
                    <span class="section-icon">üîß</span>
                    <span>Tools</span>
                </div>
                {% if is_feature_enabled('feature_servicenow_integration') and current_user.role in ['super_admin', 'account_admin', 'team_admin'] %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/servicenow') else '' }}" href="/servicenow" data-tooltip="ServiceNow Integration">
                        <i class="nav-icon bi bi-cloud-arrow-down"></i>
                        <span class="nav-text">ServiceNow Integration</span>
                    </a>
                </div>
                {% endif %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/escalation-matrix') else '' }}" href="/escalation-matrix" data-tooltip="Escalation Matrix">
                        <i class="nav-icon bi bi-exclamation-triangle"></i>
                        <span class="nav-text">Escalation Matrix</span>
                    </a>
                </div>
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/keypoints') else '' }}" href="/keypoints" data-tooltip="Key Points">
                        <i class="nav-icon bi bi-lightbulb"></i>
                        <span class="nav-text">Key Points</span>
                    </a>
                </div>
                {% if is_feature_enabled('feature_ctask_assignment') and current_user.role in ['super_admin', 'account_admin', 'team_admin'] %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/ctask-assignment') else '' }}" href="/ctask-assignment" data-tooltip="CTask Assignment">
                        <i class="nav-icon bi bi-person-check"></i>
                        <span class="nav-text">CTask Assignment</span>
                    </a>
                </div>
                {% endif %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/audit-logs') else '' }}" href="/audit-logs" data-tooltip="Audit Logs">
                        <i class="nav-icon bi bi-clipboard-data"></i>
                        <span class="nav-text">Audit Logs</span>
                    </a>
                </div>
            </div>
            
            <!-- Administration Section -->
            {% if current_user.is_authenticated and current_user.role in ['super_admin', 'account_admin', 'team_admin'] %}
            <div class="nav-section">
                <div class="section-title">
                    <span class="section-icon">‚öôÔ∏è</span>
                    <span>Administration</span>
                </div>
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/user-management') else '' }}" href="/user-management" data-tooltip="User Management">
                        <i class="nav-icon bi bi-person-gear"></i>
                        <span class="nav-text">User Management</span>
                    </a>
                </div>
                {% if current_user.role == 'super_admin' %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/admin/configuration') else '' }}" href="/admin/configuration" data-tooltip="System Configuration">
                        <i class="nav-icon bi bi-toggles"></i>
                        <span class="nav-text">System Configuration</span>
                    </a>
                </div>
                {% endif %}
                {% if current_user.role in ['super_admin', 'account_admin'] %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/admin/sso') else '' }}" href="/admin/sso/" data-tooltip="SSO Configuration">
                        <i class="nav-icon bi bi-shield-lock"></i>
                        <span class="nav-text">SSO Configuration</span>
                    </a>
                </div>
                {% endif %}
                {% if current_user.role == 'super_admin' %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/admin/secrets') else '' }}" href="/admin/secrets/" data-tooltip="Secrets Management">
                        <i class="nav-icon bi bi-key"></i>
                        <span class="nav-text">Secrets Management</span>
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Knowledge Base Section -->
            {% if is_tab_enabled('tab_kb_articles') or is_tab_enabled('tab_vendor_details') or is_tab_enabled('tab_applications') %}
            <div class="nav-section">
                <div class="section-title">
                    <span class="section-icon">üìö</span>
                    <span>Knowledge Base</span>
                </div>
                {% if is_tab_enabled('tab_kb_articles') %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/kb-details') else '' }}" href="/kb-details" data-tooltip="KB Articles">
                        <i class="nav-icon bi bi-book"></i>
                        <span class="nav-text">KB Articles</span>
                    </a>
                </div>
                {% endif %}
                {% if is_tab_enabled('tab_vendor_details') %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/vendor-details') else '' }}" href="/vendor-details" data-tooltip="Vendor Details">
                        <i class="nav-icon bi bi-building"></i>
                        <span class="nav-text">Vendor Details</span>
                    </a>
                </div>
                {% endif %}
                {% if is_tab_enabled('tab_applications') %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/application-details') else '' }}" href="/application-details" data-tooltip="Applications">
                        <i class="nav-icon bi bi-app-indicator"></i>
                        <span class="nav-text">Applications</span>
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <!-- Advanced Section -->
            {% if is_tab_enabled('tab_change_management') or is_tab_enabled('tab_problem_tickets') or is_tab_enabled('tab_post_mortems') %}
            <div class="nav-section">
                <div class="section-title">
                    <span class="section-icon">üöÄ</span>
                    <span>Advanced</span>
                </div>
                {% if is_tab_enabled('tab_change_management') %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/change-management') else '' }}" href="/change-management">
                        <i class="nav-icon bi bi-arrow-repeat"></i>
                        <span class="nav-text">Change Management</span>
                        <span class="nav-badge"></span>
                    </a>
                </div>
                {% endif %}
                {% if is_tab_enabled('tab_problem_tickets') %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/problem-tickets') else '' }}" href="/problem-tickets">
                        <i class="nav-icon bi bi-bug"></i>
                        <span class="nav-text">Problem Tickets</span>
                    </a>
                </div>
                {% endif %}
                {% if is_tab_enabled('tab_post_mortems') %}
                <div class="modern-nav-item">
                    <a class="modern-nav-link {{ 'active' if is_nav_active('/postmortem-details') else '' }}" href="/postmortem-details">
                        <i class="nav-icon bi bi-search"></i>
                        <span class="nav-text">Post-mortems</span>
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <!-- Enhanced User Profile -->
        {% if current_user.is_authenticated %}
        <div class="sidebar-user-profile" onclick="toggleUserDropdown(event)">
            <div class="user-profile-content">
                <div class="user-avatar-container">
                    <img src="https://ui-avatars.com/api/?name={{ current_user.username|urlencode }}&background=74b9ff&color=fff&size=48" 
                         alt="User Avatar" class="user-avatar-modern">
                    <div class="user-status-indicator"></div>
                </div>
                <div class="user-info">
                    <div class="user-name">{{ current_user.username }}</div>
                    <div class="user-role">{{ current_user.role|title|replace('_', ' ') }}</div>
                </div>
                <i class="bi bi-chevron-right user-dropdown-arrow"></i>
            </div>
            
            <!-- User Profile Dropdown -->
            <div class="user-profile-dropdown">
                <div class="dropdown-header-modern">Account</div>
                <a href="/profile" class="dropdown-item-modern">
                    <i class="bi bi-person-circle"></i>
                    My Profile
                </a>
                <a href="/account-settings" class="dropdown-item-modern">
                    <i class="bi bi-gear"></i>
                    Account Settings
                </a>
                <div class="dropdown-divider-modern"></div>
                <div class="dropdown-header-modern">Notifications</div>
                <a href="/notifications" class="dropdown-item-modern">
                    <i class="bi bi-bell"></i>
                    Notifications
                    <span class="badge bg-primary ms-auto">3</span>
                </a>
                <a href="/alerts" class="dropdown-item-modern">
                    <i class="bi bi-exclamation-triangle"></i>
                    System Alerts
                </a>
                <div class="dropdown-divider-modern"></div>
                <div class="dropdown-header-modern">Quick Actions</div>
                <a href="/help" class="dropdown-item-modern">
                    <i class="bi bi-question-circle"></i>
                    Help & Support
                </a>
                <a href="/about" class="dropdown-item-modern">
                    <i class="bi bi-info-circle"></i>
                    About
                </a>
                <div class="dropdown-divider-modern"></div>
                <a href="/logout" class="dropdown-item-modern text-danger">
                    <i class="bi bi-box-arrow-right"></i>
                    Sign Out
                </a>
            </div>
        </div>
        {% endif %}
        
        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
            <small>¬© 2025 Shift Handover</small>
        </div>
    </nav>
    
    <!-- Main Content Area -->
    <main class="main-content-modern" id="mainContent">
        <div class="container-fluid p-4">
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="mb-3">
                        {% for message in messages %}
                            <div class="alert alert-info alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </div>
    </main>
    {% else %}
    <div class="d-flex align-items-center justify-content-center vh-100" style="background: linear-gradient(135deg, #e9ecef 0%, #f8f9fa 100%);">
        <div class="card shadow-lg p-4" style="min-width: 350px; max-width: 400px; width: 100%; border-radius: 1rem;">
            <div class="card-body">
                {% if not show_sidebar %}
                    {{ self.content() }}
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    <!-- Profile Modals -->
    
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="profileModalLabel"><i class="bi bi-person me-2"></i>User Profile</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div class="bg-primary rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
                            <i class="bi bi-person-fill text-white fs-1"></i>
                        </div>
                        <h4>{{ current_user.username }}</h4>
                        <p class="text-muted">{{ current_user.role|title }}</p>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-4"><strong>Username:</strong></div>
                        <div class="col-sm-8">{{ current_user.username }}</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-sm-4"><strong>Role:</strong></div>
                        <div class="col-sm-8">{{ current_user.role|title }}</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-sm-4"><strong>Status:</strong></div>
                        <div class="col-sm-8"><span class="badge bg-success">Active</span></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-secondary text-white">
                    <h5 class="modal-title" id="settingsModalLabel"><i class="bi bi-gear me-2"></i>Settings</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label"><strong>Theme Preference</strong></label>
                        <select class="form-select">
                            <option selected>Light Theme</option>
                            <option>Dark Theme</option>
                            <option>Auto (System)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label"><strong>Language</strong></label>
                        <select class="form-select">
                            <option selected>English</option>
                            <option>Spanish</option>
                            <option>French</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                            <label class="form-check-label" for="emailNotifications">
                                Email Notifications
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="browserNotifications">
                            <label class="form-check-label" for="browserNotifications">
                                Browser Notifications
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal fade" id="notificationsModal" tabindex="-1" aria-labelledby="notificationsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="notificationsModalLabel"><i class="bi bi-bell me-2"></i>Notifications</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <i class="bi bi-bell-slash text-muted mb-3" style="font-size: 3rem;"></i>
                        <h5>No new notifications</h5>
                        <p class="text-muted">You're all caught up! Check back later for updates.</p>
                    </div>
                    <hr>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex align-items-center">
                            <i class="bi bi-info-circle text-info me-3"></i>
                            <div>
                                <h6 class="mb-0">System Maintenance</h6>
                                <small class="text-muted">Scheduled for next Sunday at 2:00 AM</small>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-center">
                            <i class="bi bi-check-circle text-success me-3"></i>
                            <div>
                                <h6 class="mb-0">Profile Updated</h6>
                                <small class="text-muted">Your profile was successfully updated</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-outline-primary" onclick="markAllAsRead()">Mark All as Read</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Functions -->
    <script>
        function showProfileModal() {
            const modal = new bootstrap.Modal(document.getElementById('profileModal'));
            modal.show();
        }

        function showSettingsModal() {
            const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
            modal.show();
        }

        function showNotificationsModal() {
            const modal = new bootstrap.Modal(document.getElementById('notificationsModal'));
            modal.show();
        }

        function saveSettings() {
            // Add settings save logic here
            alert('Settings saved successfully!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('settingsModal'));
            modal.hide();
        }

        function markAllAsRead() {
            // Add mark as read logic here
            alert('All notifications marked as read!');
            const modal = bootstrap.Modal.getInstance(document.getElementById('notificationsModal'));
            modal.hide();
        }

        // Modern Sidebar Navigation JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('modernSidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const toggleIcon = document.getElementById('toggleIcon');
            const mainContent = document.getElementById('mainContent');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            
            // Sidebar toggle functionality
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    console.log('Sidebar toggle clicked');
                    sidebar.classList.toggle('collapsed');
                    mainContent.classList.toggle('sidebar-collapsed');
                    
                    // Force refresh of icon visibility
                    const icons = sidebar.querySelectorAll('.nav-icon, .section-icon');
                    icons.forEach(icon => {
                        if (sidebar.classList.contains('collapsed')) {
                            icon.style.display = 'block';
                            icon.style.opacity = '1';
                            icon.style.visibility = 'visible';
                        }
                    });
                    
                    // Update toggle icon
                    if (sidebar.classList.contains('collapsed')) {
                        toggleIcon.className = 'bi bi-chevron-right';
                        console.log('Sidebar collapsed');
                    } else {
                        toggleIcon.className = 'bi bi-chevron-left';
                        console.log('Sidebar expanded');
                    }
                    
                    // Save sidebar state to localStorage
                    localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
                    
                    // Force a slight delay to ensure CSS is applied
                    setTimeout(() => {
                        const allIcons = sidebar.querySelectorAll('.nav-icon');
                        console.log('Found icons:', allIcons.length);
                        allIcons.forEach((icon, index) => {
                            console.log(`Icon ${index}: display=${getComputedStyle(icon).display}, opacity=${getComputedStyle(icon).opacity}`);
                        });
                    }, 100);
                });
            }
            
            // Restore sidebar state from localStorage
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (sidebarCollapsed && sidebar) {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-collapsed');
                toggleIcon.className = 'bi bi-chevron-right';
                
                // Force icon visibility on page load
                setTimeout(() => {
                    const icons = sidebar.querySelectorAll('.nav-icon, .section-icon');
                    icons.forEach(icon => {
                        icon.style.display = 'block';
                        icon.style.opacity = '1';
                        icon.style.visibility = 'visible';
                    });
                    console.log('Restored collapsed state with visible icons');
                }, 200);
            }
            
            // Mobile sidebar functionality
            function handleMobile() {
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('collapsed');
                    mainContent.classList.remove('sidebar-collapsed');
                    
                    if (sidebarToggle) {
                        sidebarToggle.addEventListener('click', function(e) {
                            e.preventDefault();
                            sidebar.classList.toggle('show');
                            sidebarOverlay.classList.toggle('show');
                        });
                    }
                    
                    if (sidebarOverlay) {
                        sidebarOverlay.addEventListener('click', function() {
                            sidebar.classList.remove('show');
                            sidebarOverlay.classList.remove('show');
                        });
                    }
                }
            }
            
            // Handle window resize
            window.addEventListener('resize', handleMobile);
            handleMobile();
            
            // Add active state management
            const navLinks = document.querySelectorAll('.modern-nav-link');
            const currentPath = window.location.pathname;
            
            navLinks.forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
                
                // Add click animation
                link.addEventListener('click', function(e) {
                    // Remove active from all links
                    navLinks.forEach(l => l.classList.remove('active'));
                    // Add active to clicked link
                    this.classList.add('active');
                    
                    // Add click effect
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
            
            // Add hover effects for nav sections
            const navSections = document.querySelectorAll('.nav-section');
            navSections.forEach(section => {
                section.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(2px)';
                });
                
                section.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0)';
                });
            });
            
            // User profile dropdown animation
            const userProfile = document.querySelector('.sidebar-user-profile');
            if (userProfile) {
                userProfile.addEventListener('click', function() {
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            }
            
            // Smooth scroll to top when logo is clicked
            const sidebarBrand = document.querySelector('.sidebar-brand');
            if (sidebarBrand) {
                sidebarBrand.addEventListener('click', function(e) {
                    if (this.getAttribute('href') === '/') {
                        e.preventDefault();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        window.location.href = '/';
                    }
                });
            }
            
            // Add tooltip functionality for collapsed sidebar
            function initTooltips() {
                const navLinks = document.querySelectorAll('.modern-nav-link');
                navLinks.forEach(link => {
                    const text = link.querySelector('.nav-text');
                    if (text && !link.querySelector('.nav-tooltip')) {
                        const tooltip = document.createElement('div');
                        tooltip.className = 'nav-tooltip';
                        tooltip.textContent = text.textContent;
                        link.appendChild(tooltip);
                    }
                });
            }
            
            initTooltips();
        });

        // User Profile Dropdown Functionality
        function toggleUserDropdown(event) {
            event.stopPropagation();
            const userProfile = document.querySelector('.sidebar-user-profile');
            userProfile.classList.toggle('show-dropdown');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userProfile = document.querySelector('.sidebar-user-profile');
            if (userProfile && !userProfile.contains(event.target)) {
                userProfile.classList.remove('show-dropdown');
            }
        });

        // Close dropdown when pressing Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const userProfile = document.querySelector('.sidebar-user-profile');
                if (userProfile) {
                    userProfile.classList.remove('show-dropdown');
                }
            }
        });
    </script>

</body>
</html>

